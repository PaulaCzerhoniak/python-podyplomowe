{% extends "base.html" %}

{% block title %}Dodaj / Edytuj klienta{% endblock %}

{% block content %}
<h1>Dodaj / Edytuj klienta</h1>

<form method="post" style="max-width: 400px;">
    {% csrf_token %}

    {% if form.errors %}
    <div class="alert alert-danger">
        {% for field in form %}
            {% for error in field.errors %}
                <p><strong>{{ field.label }}:</strong> {{ error }}</p>
            {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
            <p>{{ error }}</p>
        {% endfor %}
    </div>
    {% endif %}

    <div class="mb-3">
        {{ form.first_name.label_tag }}
        {{ form.first_name }}
    </div>

    <div class="mb-3">
        {{ form.last_name.label_tag }}
        {{ form.last_name }}
    </div>

    <div class="mb-3">
        {{ form.phone.label_tag }}
        {{ form.phone }}
    </div>

    <div class="mb-3">
        {{ form.customer_type.label_tag }}
        {{ form.customer_type }}
    </div>

    <div class="mb-3" id="vip-discount-container">
        {{ form.discount_percent.label_tag }}
        {{ form.discount_percent }}
        <small>(tylko dla VIP)</small>
    </div>

    <div class="mb-3">
        {{ form.loyalty_points.label_tag }}
        {{ form.loyalty_points }}
    </div>

    <div class="d-flex gap-2 mt-3">
        <button type="submit" class="btn btn-success">Zapisz</button>
        <a href="{% url 'customer_list' %}" class="btn btn-secondary">Powrót do listy klientów</a>
    </div>
</form>

<script>
const customerTypeSelect = document.getElementById('id_customer_type');
const vipDiscountContainer = document.getElementById('vip-discount-container');

function toggleVipDiscount() {
    if (customerTypeSelect) {
        vipDiscountContainer.style.display =
            customerTypeSelect.value === 'vip' ? 'block' : 'none';
    }
}

toggleVipDiscount();

if (customerTypeSelect) {
    customerTypeSelect.addEventListener('change', toggleVipDiscount);
}
</script>

{% endblock %}